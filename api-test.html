<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test Tool</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; line-height: 1.6; }
        .container { border: 1px solid #ccc; padding: 20px; border-radius: 5px; }
        button { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        pre { background-color: #f5f5f5; padding: 10px; overflow-x: auto; border-radius: 4px; }
        .success { color: green; }
        .error { color: red; }
        .loading { color: orange; }
        h3 { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>API Connection Debugger</h1>
    
    <div class="container">
        <h2>1. Test InfinityFree API Connection</h2>
        <button onclick="testApiDirectly()">Test Direct API Connection</button>
        <div id="directApiResult">Results will appear here...</div>
        
        <h2>2. Check Current API URL Configuration</h2>
        <button onclick="checkApiUrl()">Check API URL</button>
        <div id="apiUrlResult">Results will appear here...</div>
        
        <h2>3. Test Custom Debug Endpoint</h2>
        <button onclick="testCorsDebug()">Test CORS Debug Endpoint</button>
        <div id="corsDebugResult">Results will appear here...</div>
        
        <h2>4. Browser Information</h2>
        <div id="browserInfo"></div>
    </div>

    <script>
        // Display browser information
        document.getElementById('browserInfo').innerHTML = `
            <p>User Agent: ${navigator.userAgent}</p>
            <p>Platform: ${navigator.platform}</p>
            <p>Browser: ${navigator.appName}</p>
            <p>Version: ${navigator.appVersion}</p>
        `;

        async function testApiDirectly() {
            const resultDiv = document.getElementById('directApiResult');
            resultDiv.innerHTML = '<p class="loading">Testing direct API connection...</p>';
            
            try {
                const response = await fetch('https://emiliano.great-site.net/api/dashboard', {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <p class="success">✅ API connection successful!</p>
                        <h3>Response Headers:</h3>
                        <pre>${formatHeaders(response.headers)}</pre>
                        <h3>Response Data:</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <p class="error">❌ API returned error ${response.status}: ${response.statusText}</p>
                        <pre>${await response.text()}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ Connection failed: ${error.message}</p>
                    <p>This likely indicates a CORS issue or network problem.</p>
                `;
            }
        }
        
        async function checkApiUrl() {
            const resultDiv = document.getElementById('apiUrlResult');
            resultDiv.innerHTML = '<p class="loading">Checking API URL configuration...</p>';
            
            // Check any existing API_BASE_URL in localStorage or console
            const storedApiUrl = localStorage.getItem('API_BASE_URL');
            const debugInfo = {
                "Stored API URL": storedApiUrl || "None found in localStorage",
                "document.location": document.location.href,
                "Current origin": window.location.origin
            };
            
            resultDiv.innerHTML = `
                <h3>API Configuration:</h3>
                <pre>${JSON.stringify(debugInfo, null, 2)}</pre>
                <p>Note: To see the actual API URL used by your app, check the browser console during a request.</p>
            `;
        }
        
        async function testCorsDebug() {
            const resultDiv = document.getElementById('corsDebugResult');
            resultDiv.innerHTML = '<p class="loading">Testing CORS debug endpoint...</p>';
            
            try {
                const response = await fetch('https://emiliano.great-site.net/api/cors-debug.php', {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <p class="success">✅ CORS debug successful!</p>
                        <h3>Response Headers:</h3>
                        <pre>${formatHeaders(response.headers)}</pre>
                        <h3>Response Data:</h3>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <p class="error">❌ CORS debug returned error ${response.status}: ${response.statusText}</p>
                        <pre>${await response.text()}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">❌ CORS debug failed: ${error.message}</p>
                    <p>This likely indicates a CORS issue or that the debug file is not uploaded.</p>
                `;
            }
        }
        
        // Helper to format headers
        function formatHeaders(headers) {
            let result = '';
            for (const [key, value] of headers.entries()) {
                result += `${key}: ${value}\n`;
            }
            return result;
        }
    </script>
</body>
</html>